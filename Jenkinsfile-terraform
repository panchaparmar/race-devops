pipeline {
  agent any
  environment {
    TF_VAR_environment = 'dev'
  }
  stages {
    stage('Checkout') {
      steps {
        checkout scm  // Full repo checkout (disable lightweight)
      }
    }
    stage('Terraform') {
      steps {
        withCredentials([azureSPN('jenkins-terraform-spn')]) {  // Your SPN ID
          sh '''
            which terraform || echo "Terraform not found"
            terraform --version
            terraform init -upgrade
            terraform plan
            terraform apply -auto-approve
          '''
        }
      }
    }
  }
}
